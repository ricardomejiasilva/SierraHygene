{% assign media_layout = section.settings.media_layout %}
{% assign image = section.settings.image %}
{% assign has_content = false %}
{% assign has_cta = false %}

{%- if section.settings.title != blank or section.settings.caption != blank -%}
  {% assign has_content = true %}
{%- endif -%}

{%- if section.settings.button_text != blank and section.settings.button_link != blank -%}
  {% assign has_cta = true %}
  {% assign has_content = true %}
{%- endif -%}

{% if image != blank %}
  {%- capture feature_image -%}
    {%
      render 'rimg',
      img: image,
      size: '640x426',
      class: 'feature-image',
      lazy: true,
      focal_point: image.presentation.focal_point,
    %}
  {%- endcapture -%}
{% else %}
  {%- capture feature_image -%}
    {{ 'lifestyle-1' | placeholder_svg_tag: 'placeholder-svg feature-image' }}
  {%- endcapture -%}
{% endif %}

{%- capture section_class -%}
  {{ section.settings.style }}
  full-width-{{ media_layout | replace: '_', '-' }}
  {% unless has_content %}no-content{% endunless %}
{%- endcapture -%}

<section
  class="module-container home-full-width-feature {{ section_class | strip_newlines }}"
  data-section-id="{{ section.id }}"
  data-section-type="dynamic-image-with-text"
  data-image-with-text-layout="{{ media_layout }}"
>

  <article class="module-inner home-full-width-feature-content" data-feature-content>
    {%- if media_layout == 'highlight' -%}
      {{ feature_image | strip }}
    {%- endif -%}

    {% if section.settings.title != blank %}
      <h1 class="feature-title" 
          style="color: {{ section.settings.title_color }}; 
                 font-size: {{ section.settings.title_font_size }}px; 
                 font-style: {% if section.settings.title_italic %}italic{% else %}normal{% endif %};">
        {{ section.settings.title | escape }}
      </h1>
    {% endif %}

    {% if section.settings.caption != blank %}
      <div class="rte" 
           style="color: {{ section.settings.caption_color }}; 
                  font-size: {{ section.settings.caption_font_size }}px; 
                  font-style: {% if section.settings.caption_italic %}italic{% else %}normal{% endif %};">
        {{ section.settings.caption }}
      </div>
    {% endif %}

    {%- if media_layout == 'regular' -%}
      {{ feature_image | strip }}
    {%- endif -%}

    {% if has_cta %}
      <div class="home-module-cta">
        <a class="button" href="{{ section.settings.button_link }}">{{ section.settings.button_text | escape }}</a>
      </div>
    {% endif %}
  </article>
</section>

<style>
  #shopify-section-{{ section.id }} .feature-image {
    margin-top: 30px;
    margin-bottom: 0;
  }
  
  #shopify-section-{{ section.id }} .module-inner.home-full-width-feature-content {
    margin-top: 0;
    margin-bottom: 0;
  }
</style>

{% schema %}
{
  "name": "Image with text",
  "settings": [
    {
      "type": "select",
      "id": "style",
      "label": "Style",
      "options": [
        {
          "value": "default-style",
          "label": "Default"
        },
        {
          "value": "accent-style",
          "label": "Accent"
        },
        {
          "value": "contrast-style",
          "label": "Contrast"
        }
      ],
      "default": "default-style"
    },
    {
      "type": "text",
      "id": "title",
      "label": "Heading",
      "default": "Image with text"
    },
    {
      "type": "richtext",
      "id": "caption",
      "label": "Text",
      "default": "<p>Select imagery and text that relates to your style and story.</p>"
    },
    {
      "type": "text",
      "id": "button_text",
      "label": "Button text"
    },
    {
      "type": "url",
      "id": "button_link",
      "label": "Link URL"
    },
    {
      "type": "image_picker",
      "id": "image",
      "label": "Image"
    },
    {
      "type": "select",
      "id": "media_layout",
      "label": "Layout",
      "options": [
        {
          "value": "regular",
          "label": "Text above"
        },
        {
          "value": "highlight",
          "label": "Text below"
        }
      ],
      "default": "regular"
    },
    {
      "type": "header",
      "content": "Heading Styling"
    },
    {
      "type": "color",
      "id": "title_color",
      "label": "Heading color",
      "default": "#000000"
    },
    {
      "type": "range",
      "id": "title_font_size",
      "label": "Heading font size",
      "min": 16,
      "max": 72,
      "step": 2,
      "default": 32,
      "unit": "px"
    },
    {
      "type": "checkbox",
      "id": "title_italic",
      "label": "Italic heading",
      "default": false
    },
    {
      "type": "header",
      "content": "Text Styling"
    },
    {
      "type": "color",
      "id": "caption_color",
      "label": "Text color",
      "default": "#000000"
    },
    {
      "type": "range",
      "id": "caption_font_size",
      "label": "Text font size",
      "min": 12,
      "max": 32,
      "step": 1,
      "default": 16,
      "unit": "px"
    },
    {
      "type": "checkbox",
      "id": "caption_italic",
      "label": "Italic text",
      "default": false
    }
  ],
  "presets": [
    {
      "category": "Image",
      "name": "Image with text"
    }
  ],
  "enabled_on": {
    "templates": [
      "index",
      "product",
      "page"
    ]
  }
}

{% endschema %}