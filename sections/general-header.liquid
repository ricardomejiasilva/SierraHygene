{% liquid
  assign menu = section.settings.menu
  assign products_menu = section.settings.products_menu
  assign about_us_page = section.settings.about_us_page
  if about_us_page == blank
    assign about_us_page = pages['our-story']
    if about_us_page == blank
      assign about_us_page = pages['about-us']
    endif
  endif
  assign support_page = section.settings.support_page
  assign amazon_url = section.settings.amazon_url
  assign bulk_ordering_url = section.settings.bulk_ordering_url
  assign logo = section.settings.header_logo
  assign logo_transparent = section.settings.header_logo_alternate
  assign logo_width = section.settings.logo_width
  assign logo_width_mobile = section.settings.logo_width_mobile
  assign show_country_selector = false
  assign show_locale_selector = false
  assign show_logout_link = false
  assign show_customer_name = false
  assign is_password_page = false
  assign enable_predictive_search = section.settings.enable_predictive_search

  if template contains 'password'
    assign is_password_page = true
  endif

  assign desktop_nav_style = 'center'
  assign mobile_nav_style = section.settings.mobile_nav_style | default: 'drawer'
  assign mobile_logo_center = section.settings.mobile_logo_center | default: true

  assign nav_position = 'center'
  if is_password_page
    assign nav_position = 'none'
  else
    if desktop_nav_style == 'header'
      assign nav_position = 'below-left'
    elsif desktop_nav_style == 'center'
      assign nav_position = 'center'
    elsif desktop_nav_style == 'left'
      assign nav_position = 'left'
    elsif desktop_nav_style == 'below'
      assign nav_position = 'below'
    elsif desktop_nav_style == 'none'
      assign nav_position = 'none'
    elsif section.settings.menu_style == 'drawer'
      assign nav_position = 'none'
    elsif section.settings.menu_style == 'below-header'
      assign nav_position = 'below'
    else
      assign nav_position = 'below-left'
    endif
  endif



  assign shopify_section_classname = 'main-header-section'
  assign sticky = section.settings.header_sticky

  if template == 'index'
    assign transparent = section.settings.transparent
  endif

  assign show_search = section.settings.show_search
  assign show_cart = section.settings.show_cart
%}

{% comment %}Inject @pixelunion/pxs-header-standard/header-standard begin{% endcomment %}
{%- comment -%}
  @param section {Object} REQUIRED
    The section object with all section data.

  @param menu {Menu} REQUIRED
    The primary menu to show in the header.

  @param shopify_section_classname
    The outer classname given to the shopify section. This is required if you wish to make the header sticky.

  @param section_classes {String}
    Any classes to add to the site-header header element.

  @param section_attributes {String}
    Any attributes to add to the site-header header element.

  @param wrapper_classes {String}
    Any classes to add to the site-header__wrapper element.

  @param nav_position {String}
    The position of the navigation in the header, one of "left", "center", "below", or "none". Default is "center".

  @param sticky {Boolean}
    If true, the header will apply a sticky styles to the outer shopify_section_classname. Default false.

  @param transparent {Boolean}
    If true, the header will apply a `data-transparent-header` attribute to the body element which the header can use. After scrolling, the attribute's value will change. Default false.

  @param logo {Image}
    The logo to be shown in the header. If no logo is provided, the site name will be used instead.

  @param logo_transparent {Image}
    The logo to be shown in the header when the header is transparent. If no logo is provided, the header will default to use the normal logo.

  @param logo_mobile {Image}
    The logo to be shown in the header on smaller devices. If no logo is provided, the mobile header will default to use the normal logo.

  @param logo_width {Number}
    The width of the logo in the header, the image will use its natural aspect ratio based on this width. This should be provided so that image placeholders have the correct size.

  @param logo_width_mobile
    The width of the mobile logo for smaller devices. If no width is provided, it will default to using logo_width.

  @param show_search
    Will show the search button if true in both the first and last header controls blocks. Default false.

  @param show_account
    Will show the account button if true in the last header controls block. Will only show if accounts are enabled. Default true.

  @param show_cart
    Will show the cart button if true in the last header controls block. Default true.
{%- endcomment -%}

{% liquid
  assign section_classes = section_classes | default: ''
  assign section_attributes = section_attributes | default: ''
  assign shopify_section_classname = shopify_section_classname | default: ''
  assign wrapper_classes = wrapper_classes | default: ''
  assign nav_position = nav_position | default: 'center'
  assign sticky = sticky | default: false
  assign transparent = transparent | default: false
  assign logo = logo | default: false
  assign logo_transparent = logo_transparent | default: false
  assign logo_mobile = logo_mobile | default: false
  assign logo_width = logo_width | default: '300'
  assign logo_width_mobile = logo_width_mobile | default: logo_width
  assign logo_width_size = logo_width | append: 'x'
  assign logo_width_mobile_size = logo_width_mobile | append: 'x'
  assign show_search = show_search | default: false
  assign show_account = show_account | default: true
%}

<script
  type="application/json"
  data-section-type="pxs-header-standard"
  data-section-id="{{ section.id }}"
  data-section-data
>
  {
    "sticky": {{ sticky | json }},
    "transparent": {{ transparent | json }}
  }
</script>

{% if sticky and shopify_section_classname != '' %}
  <style>
    .{{ shopify_section_classname }} {
      position: sticky;
      top: 0;
    }
  </style>
{% endif %}

<style>
  /* Desktop Navigation Styles */
  @media (min-width: 720px) {
    .header-nav--desktop-only {
      display: flex !important;
    }
    
    .site-header__menu-button--mobile-only {
      display: none !important;
    }
    
    .site-header--desktop-nav-header .header-nav {
      justify-content: center;
    }
    
    .site-header--desktop-nav-left .header-nav__tier-1 {
      justify-content: flex-start;
    }
    
    .site-header--desktop-nav-below .header-nav {
      position: absolute;
      top: 100%;
      left: 0;
      width: 100%;
      background-color: {{ settings.header-background-color }};
      border-top: 1px solid {{ settings.border-color }};
      padding: 1rem 0;
    }
    
    /* Two-row layout: Logo/buttons on top, nav below on left */
    .site-header--nav-position-below-left .site-header__nav-row {
      background-color: {{ settings.header-background-color }};
      padding: 0 0 0.75rem 0;
    }
    
    .site-header--nav-position-below-left .header-nav--below-left {
      justify-content: flex-start;
    }
    
    .site-header--nav-position-below-left .header-nav__tier-1 {
      justify-content: flex-start;
      margin-left: 0;
    }
    
    .site-header--nav-position-below-left .header-nav__tier-1-item:first-child .header-nav__tier-1-link {
      padding-left: 0;
    }
    
    .site-header--desktop-nav-none .header-nav--desktop-only {
      display: none !important;
    }
    
    .site-header--desktop-nav-none .site-header__menu-button--mobile-only {
      display: block !important;
    }
  }

  /* Mobile Navigation Styles */
  @media (max-width: 719px) {
    .header-nav--desktop-only {
      display: none !important;
    }
    
    .site-header__menu-button--mobile-only {
      display: block !important;
    }
    
    .site-header--mobile-logo-center .site-header__title {
      order: 2;
      flex: 1;
      text-align: center;
    }
    
    .site-header--mobile-logo-center .site-header__controls--first {
      order: 1;
    }
    
    .site-header--mobile-logo-center .site-header__controls--last {
      order: 3;
    }
    
    .site-header--mobile-nav-visible .header-nav--desktop-only {
      display: flex !important;
      position: absolute;
      top: 100%;
      left: 0;
      width: 100%;
      background-color: {{ settings.header-background-color }};
      border-top: 1px solid {{ settings.border-color }};
      padding: 1rem 30px;
      flex-direction: column;
    }
    
    .site-header--mobile-nav-visible .header-nav__tier-1 {
      flex-direction: column;
      align-items: stretch;
    }
    
    .site-header--mobile-nav-visible .header-nav__tier-1-link {
      padding: 0.75rem 0;
      border-bottom: 1px solid {{ settings.border-color | color_modify: 'alpha', 0.3 }};
    }
    
    .site-header--mobile-nav-visible .site-header__menu-button--mobile-only {
      display: none !important;
    }
  }

  /* Responsive adjustments */
  .site-header--nav-position-center .site-header__wrapper {
    justify-content: space-between;
  }
  
  @media (min-width: 720px) {
    .site-header--nav-position-center.site-header--desktop-nav-header .site-header__wrapper {
      justify-content: flex-start;
      gap: 2rem;
    }
    
    /* Ensure proper spacing for below-left layout */
    .site-header--nav-position-below-left .site-header__wrapper {
      justify-content: space-between;
    }
    
    .site-header--nav-position-below-left .site-header__title {
      text-align: left;
      flex: 0 0 auto;
    }
  }
</style>


<header
  class="
    site-header
    site-header--two-row
    site-header--mobile-nav-{{ mobile_nav_style }}
    {% if mobile_logo_center %}site-header--mobile-logo-center{% endif %}
    {{ section_classes }}
  "
  data-site-header
  data-desktop-nav="{{ desktop_nav_style }}"
  data-mobile-nav="{{ mobile_nav_style }}"
  {{ section_attributes }}
>
  <!-- Top Row: Logo | Search | Account | Cart -->
  <div class="site-header__top-row">
    <div class="site-header__wrapper">
      <div class="site-header__controls site-header__controls--first" data-header-controls>
        <button
          class="site-header__menu-button site-header__menu-button--first site-header__menu-button--mobile-only"
          data-menu-button
          aria-haspopup="true"
        >
          <span class="site-header__menu-text">{{ 'sections.header.menu' | t }}</span>
        </button>
      </div>

      {% comment %} Only the home page should use an <h1> for the logo. All other pages should use an <h2>{% endcomment %}
      {% if template contains 'index' %}
        <h1 class="site-header__title">
      {% else %}
        <h2 class="site-header__title">
      {% endif %}
        <a
          href="{{ routes.root_url }}"
          class="site-header__logo site-header__logo--has-image"
          style="--logo-width: {{ logo_width }}px; --logo-width-mobile: {{ logo_width_mobile }}px;"
          aria-label="{{ shop.name }}"
          data-header-logo
        >
          <div class="site-header__logo-image" data-logo-image>
            <img src="{{ 'logo-green.svg' | asset_url }}" alt="{{ shop.name }}" width="{{ logo_width }}" height="{{ logo_width | divided_by: 3 | round }}" style="width: 100%; height: auto;" />
          </div>
          <span class="site-header__site-name">{{ shop.name }}</span>
        </a>
      {% if template contains 'index' %}
        </h1>
      {% else %}
        </h2>
      {% endif %}

      {% if show_search %}
        <div class="site-header__search-bar">
          <form class="site-header__search-form" action="{{ routes.search_url }}" method="get">
            <div class="site-header__search-input-wrapper">
              <span class="site-header__search-icon">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <circle cx="11" cy="11" r="7" stroke="currentColor" stroke-width="1.5"/>
                  <path d="M20 20L16.5 16.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                </svg>
              </span>
              <input
                type="text"
                name="q"
                class="site-header__search-input"
                placeholder="Search for..."
                aria-label="{{ 'sections.header.search' | t }}"
                autocomplete="off"
              >
            </div>
          </form>
        </div>
      {% endif %}

      <div class="site-header__controls site-header__controls--last" data-header-controls>
        {% if show_account and shop.customer_accounts_enabled %}
          <a
            href="{% if customer %}{{ routes.account_url }}{% else %}{{ routes.account_login_url }}{% endif %}"
            class="site-header__account-button site-header__account-button--with-text"
            data-account-button
          >
            <span class="site-header__account-text">Account</span>
          </a>
        {% endif %}
        {% if show_cart %}
          <a
            href="{{ routes.cart_url }}"
            class="site-header__cart-button site-header__cart-button--styled"
            data-cart-button
          >
            <span class="site-header__cart-text">{{ 'sections.header.cart' | t }}</span>
            <span class="site-header__cart-total" data-cart-total>{{ cart.total_price | money }}</span>
            <span class="site-header__cart-count-styled" data-cart-count>({{ cart.item_count }})</span>
          </a>
        {% endif %}
      </div>
    </div>
  </div>

  <!-- Divider Line -->
  <div class="site-header__divider"></div>

  <!-- Bottom Row: Navigation -->
  <div class="site-header__nav-row">
    <div class="site-header__wrapper">
      {%
        render 'header-nav',
        menu: menu,
        products_menu: products_menu,
        about_us_page: about_us_page,
        support_page: support_page,
        amazon_url: amazon_url,
        bulk_ordering_url: bulk_ordering_url,
        section: section,
        nav_classes: 'header-nav--desktop-only header-nav--two-row'
      %}
    </div>
  </div>

  {% comment %} When JS is disabled, set standard header with logo left, menu right {% endcomment %}
  <noscript>
    {%
      render 'header-nav',
      menu: menu,
      products_menu: products_menu,
      about_us_page: about_us_page,
      support_page: support_page,
      amazon_url: amazon_url,
      bulk_ordering_url: bulk_ordering_url,
      section: section,
      nav_classes: 'header-nav--js-disabled',
      nav_position: nav_position
    %}
  </noscript>
</header>

<div data-header-scroll-observer></div>
{% comment %}Inject @pixelunion/pxs-header-standard/header-standard end{% endcomment %}

{% comment %}Inject @pixelunion/pxs-drawer-nav-standard/drawer-nav-standard begin{% endcomment %}
{%- comment -%}
  @param menu {Menu} REQUIRED
    The menu to show in the drawer nav.

  @param show_logout_link { Boolean }
    If true, a log out link will be shown in the drawer nav.

  @param show_customer_name { Boolean }
    If true, the customer name will be shown in the drawer nav (replacing the "My account" text).

  @param show_country_selector {Boolean}
    If true, will create a country/currency selector disclosure element inside of a footer element in the drawer nav.

  @param show_locale_selector {Boolean}
    If true, will create a locale selector disclosure element inside of a footer element in the drawer nav.
{%- endcomment -%}

<nav class="drawer-nav" data-drawer-nav tabindex="-1" aria-label="{{ 'components.drawer-nav.drawer-menu' | t }}">
  <div class="drawer-nav__overlay" data-drawer-overlay></div>
  <div class="drawer-nav__flyout" data-drawer-main-flyout>
    <div class="drawer-nav__mobile-header">
      <button
        class="drawer-nav__close-button"
        data-drawer-nav-close
      >
        <span>{{ 'components.drawer-nav.close' | t }}</span>
      </button>
      <div class="drawer-nav__logo">
        <img src="{{ 'logo-green.svg' | asset_url }}" alt="{{ shop.name }}" width="130" height="43" />
      </div>
      <a href="{{ routes.cart_url }}" class="drawer-nav__cart-icon">
        <span class="drawer-nav__cart-count" data-cart-count>{{ cart.item_count }}</span>
      </a>
    </div>
    
    <div class="drawer-nav__search-container">
      <form
        class="drawer-nav__search-form"
        action="{{ routes.search_url }}"
        method="get"
      >
        <div class="drawer-nav__search-wrapper">
          <input
            type="text"
            name="q"
            class="drawer-nav__search-input"
            placeholder="{{ 'general.general.search_placeholder' | t }}"
            aria-label="{{ 'sections.header.search' | t }}"
            autocomplete="off"
            data-drawer-search-input
          >
          <button
            type="submit"
            class="drawer-nav__search-submit"
            aria-label="{{ 'general.general.submit' | t }}"
          >
            <span class="visually-hidden">{{ 'general.general.submit' | t }}</span>
          </button>
        </div>
        {%- if enable_predictive_search -%}
          <div
            class="drawer-nav__predictive-search-container"
            data-drawer-predictive-search-container
          >
            <div data-drawer-predictive-search-results></div>
          </div>
        {%- endif -%}
      </form>
    </div>
    
    <div class="drawer-nav__actions">
      <div class="drawer-nav__action-links">
        {% if about_us_page != blank %}
          <a href="{{ about_us_page.url }}" class="drawer-nav__action-link">Our Story</a>
        {% endif %}
        {% if support_page != blank %}
          <a href="{{ support_page.url }}" class="drawer-nav__action-link">Support</a>
        {% endif %}
      </div>
      <div class="drawer-nav__action-icons">
        {% if shop.customer_accounts_enabled %}
          <a href="{% if customer %}{{ routes.account_url }}{% else %}{{ routes.account_login_url }}{% endif %}" class="drawer-nav__action-icon drawer-nav__action-icon--account">
            <span class="visually-hidden">{{ 'sections.header.account' | t }}</span>
          </a>
        {% endif %}
        <a href="{{ routes.cart_url }}" class="drawer-nav__action-icon drawer-nav__action-icon--cart">
          <span class="drawer-nav__action-cart-count" data-cart-count>{{ cart.item_count }}</span>
        </a>
      </div>
    </div>
    
    <ul class="drawer-menu__tier-1-menu">
      {% if products_menu != blank %}
        {% for link in linklists[products_menu].links %}
          <li class="drawer-menu__tier-1-item">
            <a
              href="{{ link.url }}"
              class="drawer-menu__tier-1-link"
              data-drawer-link-tier-1
            >
              {{ link.title | escape }}
            </a>
          </li>
        {% endfor %}
      {% endif %}
      
      {% for link_tier_1 in linklists[menu].links %}
        {% assign has_tier_2 = false %}
        {% if link_tier_1.links.size > 0 %}
          {% assign has_tier_2 = true %}
        {% endif %}

        <li
          class="drawer-menu__tier-1-item"
        >
          {% if has_tier_2 == false %}
            <a
              href="{{ link_tier_1.url }}"
              class="drawer-menu__tier-1-link"
              data-drawer-link-tier-1
            >
              {{ link_tier_1.title | escape }}
            </a>
          {% else %}
            <button
              class="drawer-menu__tier-1-button"
              aria-haspopup="true"
              data-drawer-submenu-button="tier-1"
              data-drawer-link-tier-1
            >
              {{ link_tier_1.title | escape }}
            </button>

            <div
              class="drawer-menu__tier-2"
              data-drawer-tier-2-flyout
              tabindex="-1"
              aria-label="{{ 'components.drawer-nav.menu' | t: title: link_tier_1.title }}"
            >
              <div
                class="drawer-menu__tier-2-overlay"
                data-drawer-submenu-overlay
              ></div>
              <div
                class="drawer-menu__tier-2-flyout"
                data-drawer-submenu-flyout
              >
                <div class="drawer-menu__tier-2-header">
                  <button
                    class="drawer-menu__back-button"
                    data-drawer-back-button
                  >
                    <span>{{ 'components.drawer-nav.back' | t }}</span>
                  </button>
                  <a href="{{ link_tier_1.url }}" class="drawer-menu__heading">{{ link_tier_1.title | escape }}</a>
                  <button
                    class="drawer-menu__close-button"
                    data-drawer-close-button
                  >
                    <span>{{ 'components.drawer-nav.close' | t }}</span>
                  </button>
                </div>
                <ul
                  class="drawer-menu__tier-2-menu"
                >
                  {% for link_tier_2 in link_tier_1.links %}
                    {% assign has_tier_3 = false %}
                    {% if link_tier_2.links.size > 0 %}
                      {% assign has_tier_3 = true %}
                    {% endif %}
                    <li
                      class="drawer-menu__tier-2-item"
                    >
                      {% if has_tier_3 == false %}
                        <a
                          href="{{ link_tier_2.url }}"
                          class="drawer-menu__tier-2-link"
                          data-drawer-link-tier-2
                        >
                          {{ link_tier_2.title | escape }}
                        </a>
                      {% else has_tier_3 %}
                        <button
                          class="drawer-menu__tier-2-button"
                          aria-haspopup="true"
                          data-drawer-submenu-button="tier-2"
                          data-drawer-link-tier-2
                        >
                          {{ link_tier_2.title | escape }}
                        </button>

                        <div
                          class="drawer-menu__tier-3"
                          data-drawer-tier-3-flyout
                          tabindex="-1"
                          aria-label="{{ 'components.drawer-nav.menu' | t: title: link_tier_2.title }}"
                        >
                          <div
                            class="drawer-menu__tier-3-overlay"
                            data-drawer-submenu-overlay
                          ></div>
                          <div
                            class="drawer-menu__tier-3-flyout"
                            data-drawer-submenu-flyout
                          >
                            <div class="drawer-menu__tier-3-header">
                              <button
                                class="drawer-menu__back-button"
                                data-drawer-back-button
                              >
                                <span>{{ 'components.drawer-nav.back' | t }}</span>
                              </button>
                              <a href="{{ link_tier_2.url }}" class="drawer-menu__heading">{{ link_tier_2.title | escape }}</a>
                              <button
                                class="drawer-menu__close-button"
                                data-drawer-close-button
                              >
                                <span>{{ 'components.drawer-nav.close' | t }}</span>
                              </button>
                            </div>
                            <ul
                              class="drawer-menu__tier-3-menu"
                            >
                              {% for link_tier_3 in link_tier_2.links %}
                                <li
                                  class="drawer-menu__tier-3-item"
                                >
                                  <a
                                    href="{{ link_tier_3.url }}"
                                    class="drawer-menu__tier-3-link"
                                    data-drawer-link-tier-3
                                  >
                                    {{ link_tier_3.title | escape }}
                                  </a>
                                </li>
                              {% endfor %}
                            </ul>
                          </div>
                        </div>
                      {% endif %}
                    </li>
                  {% endfor %}
                </ul>
              </div>
            </div>
          {% endif %}
        </li>
      {% endfor %}
    </ul>
    {% if show_country_selector or show_locale_selector %}
      <div class="drawer-nav__footer">
        {% if show_country_selector or show_locale_selector %}
          {%- assign country_selector = show_country_selector -%}
          {%- assign locale_selector = show_locale_selector -%}
          <div class="drawer-nav__cross-border">
            {% comment %}Inject @pixelunion/shopify-cross-border/cross-border begin{% endcomment %}
            <div class="shopify-cross-border">
              {% if locale_selector and localization.available_languages.size > 1 %}
                {% comment %}Inject @pixelunion/shopify-cross-border/multi-language begin{% endcomment %}
                {% comment %} Generate a "random" number so ids are unique {% endcomment %}
                {% assign unique_id = "now" | date: "%N" | modulo: 1000 %}
                <noscript>
                  {%- form 'localization' -%}
                    <details class="disclosure">
                      <summary>
                        <span class="disclosure__toggle">
                          {{ form.current_locale.endonym_name | capitalize }}
                        </span>
                      </summary>
                      <div class="disclosure-list disclosure-list--visible">
                        {% for locale in form.available_locales %}
                          <div class="disclosure-list__item-wrapper disclosure-list__item">
                            <input
                              type="radio"
                              id="{{ locale.iso_code }}"
                              name="locale_code"
                              value="{{ locale.iso_code }}"
                              {% if locale.iso_code == form.current_locale.iso_code %}checked{% endif %}
                            >
                            <label class="disclosure-list__item--label" for="{{ locale.iso_code }}">{{ locale.endonym_name | capitalize }}</label>
                          </div>
                        {% endfor %}
                        <button class="disclosure__submit" type="submit">{{ 'general.language.submit_button_label' | t }}</button>
                      </div>
                    </details>
                  {%- endform -%}
                </noscript>
                
                {%- form 'localization' -%}
                  <div class="selectors-form__item selectors-form--no-js-hidden">
                    <div class="disclosure" data-disclosure-locale>
                      <h2 class="visually-hidden" id="lang-heading-{{ unique_id }}">
                        {{ 'general.language.dropdown_label' | t }}
                      </h2>
                
                      <button
                        type="button"
                        class="disclosure__toggle"
                        aria-expanded="false"
                        aria-controls="lang-list-{{ unique_id }}"
                        aria-describedby="lang-heading-{{ unique_id }}"
                        data-disclosure-toggle
                      >
                        {{ form.current_locale.endonym_name | capitalize }}
                      </button>
                      <ul id="lang-list-{{ unique_id }}" class="disclosure-list" data-disclosure-list>
                        {% for locale in form.available_locales %}
                          <li>
                            <a class="disclosure-list__item {% if locale.iso_code == form.current_locale.iso_code %}disclosure-list__item--current{% endif %}" href="#" lang="{{ locale.iso_code }}" {% if locale.iso_code == form.current_locale.iso_code %}aria-current="true"{% endif %} data-value="{{ locale.iso_code }}" data-disclosure-option>
                              <span class="disclosure-list__option">{{ locale.endonym_name | capitalize }}</span>
                            </a>
                          </li>
                        {%- endfor -%}
                      </ul>
                      <input type="hidden" name="locale_code" id="LocaleSelector-{{ unique_id }}" value="{{ form.current_locale.iso_code }}" data-disclosure-input/>
                    </div>
                  </div>
                {%- endform -%}
                {% comment %}Inject @pixelunion/shopify-cross-border/multi-language end{% endcomment %}
            
              {% endif %}
            
              {% if country_selector and localization.available_countries.size > 1 %}
                {% comment %}Inject @pixelunion/shopify-cross-border/multi-country begin{% endcomment %}
                {% comment %} Generate a "random" number so ids are unique {% endcomment %}
                {% assign unique_id = "now" | date: "%N" | modulo: 1000 %}
                <noscript>
                  {%- form 'localization' -%}
                    <details class="disclosure">
                      <summary>
                        <span class="disclosure__toggle">
                          {{ localization.country.name }} ({{ localization.country.currency.iso_code }}{% if localization.country.currency.symbol %}{{ localization.country.currency.symbol }}{% endif %})
                        </span>
                      </summary>
                      <div class="disclosure-list disclosure-list--visible">
                        {% for country in localization.available_countries %}
                          <div class="disclosure-list__item-wrapper disclosure-list__item">
                            <input
                              type="radio"
                              id="{{ country.iso_code }}"
                              name="country_code"
                              value="{{ country.iso_code }}"
                              {% if country.iso_code == localization.country.iso_code %}checked{% endif %}
                            >
                            <label class="disclosure-list__item--label" for="{{ country.iso_code }}">{{ country.name }} ({{ country.currency.iso_code }}{%- if country.currency.symbol -%} {{ country.currency.symbol }}{%- endif -%})</label>
                          </div>
                        {% endfor %}
                        <button class="disclosure__submit" type="submit">{{ 'general.country.submit_button_label' | t }}</button>
                      </div>
                    </details>
                  {%- endform -%}
                </noscript>
                
                {%- form 'localization' -%}
                  <div class="selectors-form__item selectors-form--no-js-hidden">
                    <div class="disclosure" data-disclosure-country>
                      <h2 class="visually-hidden" id="country-heading-{{ unique_id }}">
                        {{ 'general.country.dropdown_label' | t }}
                      </h2>
                
                      <button
                        type="button"
                        class="disclosure__toggle"
                        aria-expanded="false"
                        aria-controls="country-list-{{ unique_id }}"
                        aria-describedby="country-heading-{{ unique_id }}"
                        data-disclosure-toggle
                      >
                        {{ localization.country.name }}
                        <span class="disclosure-list__option-code"> 
                          ({{ localization.country.currency.iso_code }}
                          {% if localization.country.currency.symbol %} {{ localization.country.currency.symbol }}{% endif %})
                        </span>
                      </button>
                      <ul id="country-list-{{ unique_id }}" class="disclosure-list" data-disclosure-list>
                        {% for country in localization.available_countries %}
                          <li>
                            <a class="disclosure-list__item {% if country.iso_code == localization.country.iso_code %}disclosure-list__item--current{% endif %}" href="#" {% if country.iso_code == localization.country.iso_code %}aria-current="true"{% endif %} data-value="{{ country.iso_code }}" data-disclosure-option>
                              <span class="disclosure-list__option">{{ country.name }}</span>
                              <span class="disclosure-list__option-code">
                                ({{ country.currency.iso_code }}
                                {% if country.currency.symbol %} {{ country.currency.symbol }}{%- endif -%})
                              </span>
                            </a>
                          </li>
                        {%- endfor -%}
                      </ul>
                      <input type="hidden" name="country_code" id="CountrySelector-{{ unique_id }}" value="{{ localization.country.iso_code }}" data-disclosure-input/>
                    </div>
                  </div>
                {%- endform -%}
                {% comment %}Inject @pixelunion/shopify-cross-border/multi-country end{% endcomment %}
            
              {% endif %}
            </div>
            {% comment %}Inject @pixelunion/shopify-cross-border/cross-border end{% endcomment %}

          </div>
        {% endif %}
      </div>
    {% endif %}
  </div>
</nav>
{% comment %}Inject @pixelunion/pxs-drawer-nav-standard/drawer-nav-standard end{% endcomment %}

<script>
  // Drawer navigation predictive search
  (function() {
    const drawerSearchInput = document.querySelector('[data-drawer-search-input]');
    const drawerPredictiveSearchContainer = document.querySelector('[data-drawer-predictive-search-container]');
    const drawerPredictiveSearchResults = document.querySelector('[data-drawer-predictive-search-results]');
    
    if (!drawerSearchInput || !drawerPredictiveSearchContainer || !drawerPredictiveSearchResults) {
      return;
    }
    
    let searchTimeout;
    const cachedResults = new Map();
    
    drawerSearchInput.addEventListener('input', function() {
      clearTimeout(searchTimeout);
      const searchTerm = this.value.trim();
      
      console.log('Search input:', searchTerm, 'Length:', searchTerm.length);
      
      if (searchTerm.length < 2) {
        drawerPredictiveSearchContainer.style.display = 'none';
        drawerPredictiveSearchResults.innerHTML = '';
        return;
      }
      
      searchTimeout = setTimeout(function() {
        fetchSearchResults(searchTerm);
      }, 300);
    });
    
    function fetchSearchResults(searchTerm) {
      console.log('Fetching results for:', searchTerm);
      
      // Check cache first
      if (cachedResults.has(searchTerm)) {
        console.log('Using cached results');
        displayResults(cachedResults.get(searchTerm));
        return;
      }
      
      // Show loading text
      drawerPredictiveSearchResults.innerHTML = '<p style="padding: 1rem; text-align: center; color: #666;">Searching...</p>';
      drawerPredictiveSearchContainer.style.display = 'block';
      console.log('Container display set to block, visible:', drawerPredictiveSearchContainer.style.display);
      
      // Use the predictive search HTML endpoint - only fetch products
      const url = `{{ routes.predictive_search_url }}?q=${encodeURIComponent(searchTerm)}&resources[type]=product&resources[limit]=8&section_id=predictive-search`;
      console.log('Fetching URL:', url);
      
      fetch(url)
        .then(response => {
          console.log('Response received:', response.status);
          if (!response.ok) {
            throw new Error('Network response was not ok');
          }
          return response.text();
        })
        .then(html => {
          console.log('HTML received, length:', html.length);
          if (!html || html.trim() === '') {
            console.log('Empty results');
            drawerPredictiveSearchResults.innerHTML = '<p class="drawer-search-no-results">No results found</p>';
            drawerPredictiveSearchContainer.style.display = 'block';
            return;
          }
          cachedResults.set(searchTerm, html);
          displayResults(html);
        })
        .catch(error => {
          console.error('Search error:', error);
          drawerPredictiveSearchResults.innerHTML = '<p class="drawer-search-no-results">Error loading results</p>';
          drawerPredictiveSearchContainer.style.display = 'block';
        });
    }
    
    function displayResults(html) {
      console.log('Displaying results');
      drawerPredictiveSearchResults.innerHTML = html;
      
      // Hide suggestions/queries/collections sections, only show products
      const container = drawerPredictiveSearchResults.querySelector('.predictive-search-results');
      if (container) {
        console.log('Found predictive-search-results container');
        const suggestions = container.querySelector('.predictive-search__queries-collections');
        const pages = container.querySelector('.predictive-search__pages-posts');
        if (suggestions) {
          console.log('Removing suggestions');
          suggestions.remove();
        }
        if (pages) {
          console.log('Removing pages');
          pages.remove();
        }
      } else {
        console.log('No predictive-search-results container found');
      }
      
      // Initialize images with the theme's image library
      setTimeout(function() {
        // Trigger theme's rimg library to watch new images
        if (typeof window.theme !== 'undefined' && window.theme.images && window.theme.images.watch) {
          console.log('Initializing images with theme.images.watch');
          window.theme.images.watch(drawerPredictiveSearchResults);
        }
        
        // Also trigger custom event that theme listens for
        const lazyImages = drawerPredictiveSearchResults.querySelectorAll('[data-rimg="lazy"]');
        lazyImages.forEach(function(img) {
          const event = new CustomEvent('theme:rimg:watch', { bubbles: true });
          img.dispatchEvent(event);
        });
        
        // Fallback: Force load images directly if they haven't loaded after a brief delay
        setTimeout(function() {
          const allImages = drawerPredictiveSearchResults.querySelectorAll('img');
          allImages.forEach(function(img) {
            // If image still doesn't have a src, try to load it from data-src or data-rimg-template
            if (!img.src || img.src === '') {
              if (img.dataset.src) {
                img.src = img.dataset.src;
              } else if (img.dataset.rimgTemplate) {
                // Build image URL from template
                const template = img.dataset.rimgTemplate;
                const size = '200x200'; // Small size for search results
                img.src = template.replace('{size}', size);
              }
            }
            // Force visibility
            img.style.opacity = '1';
            img.style.visibility = 'visible';
          });
          console.log('Fallback: Processed', allImages.length, 'images');
        }, 200);
        
        console.log('Processed', lazyImages.length, 'lazy images');
      }, 50);
      
      // Make sure container is visible
      drawerPredictiveSearchContainer.style.display = 'block';
      console.log('Final container display:', drawerPredictiveSearchContainer.style.display);
    }
    
    // Close results when clicking outside
    document.addEventListener('click', function(e) {
      if (!drawerSearchInput.contains(e.target) && !drawerPredictiveSearchContainer.contains(e.target)) {
        drawerPredictiveSearchContainer.style.display = 'none';
      }
    });
    
    // Submit form when clicking on a result
    drawerPredictiveSearchResults.addEventListener('click', function(e) {
      const link = e.target.closest('a');
      if (link) {
        drawerPredictiveSearchContainer.style.display = 'none';
      }
    });
  })();
</script>

{% comment %} ------- sarch results  ------ {% endcomment %}
<div
  class="header-search-container"
  data-header-search
  {% if enable_predictive_search %}data-enable-predictive-search{% endif %}
  data-header-search-state="hidden"
>
  <form
    class="
      header-search__form
      header-search__form--nav-position-{{ nav_position }}
    "
    data-header-search-form
    data-header-nav-position="{{ nav_position }}"
    action="{{ routes.search_url }}"
  >
    <input
      class="header-search__input"
      data-header-search-input
      aria-label="{{ 'general.search.header' | t }}"
      type="text"
      placeholder="{{ 'general.general.search_placeholder' | t }}"
      name="q"
      autocomplete="off"
    >
    <button
      type="submit"
      class="header-search__button-submit"
      aria-label="{{ 'general.general.submit' | t }}"
      data-search-submit
    >
    </button>
    <button
      class="header-search__button-close"
      aria-label="{{ 'general.accessibility.close_button' | t }}"
      data-search-close
    >
    </button>

    {%- if enable_predictive_search -%}
      <div
        class="header-search__predictive-search-container"
        data-predictive-search-container
        data-loading="false"
      >
        {%
          render 'icon-library',
          id: 'icon-spinner',
        %}
        <div data-predictive-search-results-container></div>
      </div>
    {%- endif -%}
  </form>
</div>

{% schema %}
{
  "name": "Header",
  "class": "main-header-section",
  "settings": [
    {
      "type": "checkbox",
      "id": "header_sticky",
      "label": "Enable sticky header",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_cart",
      "label": "Show cart icon",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_search",
      "label": "Show search icon",
      "default": true
    },
    {
      "type": "header",
      "content": "Logo"
    },
    {
      "type": "image_picker",
      "id": "header_logo",
      "label": "Logo image",
      "info": "300 x 90x .png recommended"
    },
    {
      "type": "range",
      "id": "logo_width",
      "label": "Logo max width",
      "step": 5,
      "min": 80,
      "max": 350,
      "default": 300,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "logo_width_mobile",
      "label": "Mobile logo max width",
      "step": 5,
      "min": 50,
      "max": 200,
      "default": 130,
      "unit": "px"
    },
    {
      "type": "header",
      "content": "Search behavior"
    },
    {
      "type": "checkbox",
      "id": "enable_predictive_search",
      "label": "Enable predictive search",
      "default": true
    },
    {
      "type": "header",
      "content": "Navigation"
    },
    {
      "type": "link_list",
      "id": "menu",
      "label": "Main menu",
      "default": "main-menu"
    },
    {
      "type": "link_list",
      "id": "products_menu",
      "label": "Products dropdown menu",
      "info": "Select the menu to display in the Products dropdown"
    },
    {
      "type": "page",
      "id": "about_us_page",
      "label": "Our Story page",
      "info": "Select the page to link for Our Story"
    },
    {
      "type": "page",
      "id": "support_page",
      "label": "Support page",
      "info": "Select the page to link for Support"
    },
    {
      "type": "url",
      "id": "amazon_url",
      "label": "Amazon Storefront URL",
      "info": "Enter the URL for Amazon Storefront link"
    },
    {
      "type": "url",
      "id": "bulk_ordering_url",
      "label": "Explore Bulk Ordering URL",
      "info": "Enter the URL for the Bulk Ordering page"
    },
    {
      "type": "select",
      "id": "menu_style",
      "label": "Menu style (Legacy)",
      "info": "Use the Desktop and Mobile navigation settings below for better control",
      "options": [
        {
          "value": "drawer",
          "label": "Logo center, menu drawer"
        },
        {
          "value": "header",
          "label": "Logo left, menu right"
        },
        {
          "value": "below-header",
          "label": "Logo left, menu below"
        }
      ],
      "default": "drawer"
    },
    {
      "type": "header",
      "content": "Desktop Navigation"
    },
    {
      "type": "select",
      "id": "desktop_nav_style",
      "label": "Desktop menu position",
      "options": [
        {
          "value": "header",
          "label": "Below logo (left aligned)"
        },
        {
          "value": "center",
          "label": "Next to logo (center)"
        },
        {
          "value": "left",
          "label": "Left side"
        },
        {
          "value": "below",
          "label": "Below header (full width)"
        },
        {
          "value": "none",
          "label": "Hidden (drawer only)"
        }
      ],
      "default": "header"
    },
    {
      "type": "header",
      "content": "Mobile Navigation"
    },
    {
      "type": "select",
      "id": "mobile_nav_style",
      "label": "Mobile menu style",
      "options": [
        {
          "value": "drawer",
          "label": "Hamburger menu (recommended)"
        },
        {
          "value": "visible",
          "label": "Always visible"
        }
      ],
      "default": "drawer"
    },
    {
      "type": "checkbox",
      "id": "mobile_logo_center",
      "label": "Center logo on mobile",
      "default": true
    },
    {
      "type": "header",
      "content": "Transparent header"
    },
    {
      "type": "checkbox",
      "id": "transparent",
      "label": "Enable on home page",
      "default": false,
      "info": "Will only work if the first section is a full width slideshow, video, or image with text overlay."
    },
    {
      "type": "image_picker",
      "id": "header_logo_alternate",
      "label": "Transparent header logo image",
      "info": "Optional logo used when header is transparent."
    }
  ],
  "blocks": [
    {
      "type": "meganav",
      "name": "Mega navigation",
      "limit": 5,
      "settings": [
        {
          "type": "text",
          "id": "title",
          "label": "Mega navigation trigger",
          "default": "Mega navigation",
          "info": "Add the menu item that you want to turn into a mega-nav."
        }
      ]
    }
  ]
}

{% endschema %}